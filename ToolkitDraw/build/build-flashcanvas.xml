<?xml version="1.0"?>

<project name="Create Paintcanvas jar package" basedir=".." default="package">
	<target name="configure">
		<!-- which platform we are in, possible values are windows, linux and mac -->
		<property name="gwt-platform" value="linux" />
		
		<!-- where platform specific GWT distribution is located -->
		<property name="gwt-location" value="/home/johnnie/Projects/Java/eclipse/configuration/com.vaadin.integration.eclipse/download" />
		
		<!-- where Toolkit jar is located -->
		<property name="toolkit-jar-location" value="WebContent/WEB-INF/lib/vaadin-6.2.1.jar" />
		
		<!-- where project client-side widgetset source files are located -->
		<property name="client-side-src-location" value="WebContent/WEB-INF/src" />
			
		<!-- where to generate compiled javascript and theme files -->
		<property name="client-side-destination" value="WebContent/VAADIN/widgetsets" />
		
		<!-- where the jar builds should be put -->
		<property name="build-path" value="build" />
		
		<!-- The version of the build -->
		<property name="build-version" value="0.1" />
	</target>
	
	<target name="init" depends="configure">
		<echo>Configured for ${gwt-platform} platform.</echo>
		<echo>Requirements for classpath:</echo>
		<echo>  ${gwt-location}/gwt-dev-${gwt-platform}.jar</echo>
		<echo>  ${gwt-location}/gwt-user.jar</echo>
		<echo>  ${toolkit-jar-location}</echo>
		<echo>  ${client-side-src-location}</echo>
		
		<!-- Construct classpath -->
		<path id="compile.classpath">
			<pathelement path="${client-side-src-location}" />
			<pathelement path="${toolkit-jar-location}" />
			<pathelement path="${gwt-location}/gwt-user.jar" />
			<pathelement path="${gwt-location}/gwt-dev-${gwt-platform}.jar" />
		</path>
	</target>
	
	<target name="compile-flashcanvas" depends="init">	
		<mkdir dir="${build-path}/classes"/>
		<javac srcdir="${client-side-src-location}" destdir="${build-path}/classes">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
	</target>
	
	<target name="package" depends="compile-flashcanvas">
		<mkdir dir="${build-path}/temp"/>
		<copy todir="${build-path}/temp">
			<!-- Add class files -->
			<fileset dir="${build-path}/classes">
				<filename name="**/flashcanvas/**/*.class"/>				
			</fileset>			
			<fileset dir="${build-path}/classes">
				<filename name="**/gwt/client/**/*.class"/>
			</fileset>	
			<fileset dir="${build-path}/classes">
				<filename name="**/XMLUtil.class"/>
			</fileset>
			
			<!-- Add java files -->
			<fileset dir="${client-side-src-location}">
				<filename name="**/flashcanvas/**/*.*"/>				
			</fileset>
			<fileset dir="${client-side-src-location}">
				<filename name="**/gwt/client/**/*.java"/>
			</fileset>
			<fileset dir="${client-side-src-location}">
				<filename name="**/XMLUtil.java"/>
			</fileset>
		</copy>		
		
		<!-- Create custom widgetset file -->
		<echo file= "${build-path}/temp/org/vaadin/toolkitdraw/gwt/FlashCanvasWidgetSet.gwt.xml">
			&#60;module&#62;
			&#60;script src="flashcanvas/swfobject.js" /&#62;
			&#60;stylesheet src="flashcanvas/styles.css"/&#62;
			&#60;inherits name="com.vaadin.terminal.gwt.DefaultWidgetSet" /&#62;
			&#60;/module&#62;
		</echo> 
				
		<jar jarfile="${build-path}/flashcanvas-${build-version}.jar" basedir="${build-path}/temp">
			<manifest>
						<attribute name="Vaadin-Package-Version" value="1" />
						<attribute name="Vaadin-Widgetsets" value="org.vaadin.toolkitdraw.gwt.FlashCanvasWidgetSet" />
						<attribute name="Implementation-Title" value="FlashCanvas" />
						<attribute name="Implementation-Version" value="${build-version}" />
						<attribute name="Implementation-Vendor" value="John Ahlroos" />
						<attribute name="Vaadin-License-Title" value="Apache2" />
						<attribute name="Vaadin-License-File" value="http://www.apache.org/licenses/LICENSE-2.0" />
			</manifest>
		</jar>
				
		<delete dir="${build-path}/temp" /> 
	</target>		
</project>
